# ガイドライン

このドキュメントは、プロジェクトのルール、目標、進捗管理方法を定義します。以下の内容に従ってプロジェクトを進めてください。

## 最上位ルール

- 効率を最大化するため、**複数の独立したプロセスを実行する必要がある場合は、順次実行ではなく並行実行してください**。
- **思考は英語で行いますが、ユーザーへの応答は必ず日本語で行ってください**。
- **コードの品質とセキュリティを常に最優先事項として扱ってください**。

## プロジェクトルール

### コーディング規約

- コメントとドキュメントの記述ルール：
  - **ドキュメント**（JSDoc、Docstrings等）は**英語**で記述
  - **コード内埋め込みコメント**（Vitest、zod-openapi等の説明）は**英語**で記述
  - **実装の背景や理由を説明するコードコメント**は**日本語**で記述
  - **絵文字は使用禁止**
- 日本語記述時は不要なスペースを含めない
  - 例：
    - ◯ "Claude Code入門"
    - × "Claude Code 入門"
- **コードの一貫性を保つため、既存のコードスタイルとパターンを必ず踏襲してください**
- **新しいファイルを作成する前に、既存ファイルへの追加や修正で対応できないか検討してください**

### 開発プロセス

- ライブラリの使用方法を理解するには、**必ずContext7 MCPを使用して最新情報を取得**
- `.tmp`のような隠しフォルダを検索する場合、`List`ツールでは見つけにくいため**`Bash`ツールを使用**
- **タスク完了時は必ず通知を送信**：
  - "タスク完了"とは、ユーザーへの応答を終えて次の入力を待っている状態を指す
  - **軽微なタスク**（フォーマット修正、リファクタリング、ドキュメント更新等）でも通知は必須
  - 通知フォーマット：
    ```bash
    osascript -e 'display notification "${TASK_DESCRIPTION}が完了しました" with title "${REPOSITORY_NAME}"'
    ```

### テストとデバッグ

- **すべての新機能には必ずテストを作成してください**
- **既存のテストを壊さないよう、変更前に必ずテストを実行してください**
- エラーハンドリング：
  - 予期される例外は適切にキャッチして処理
  - エラーメッセージは明確で実用的な内容にする
  - ログは適切なレベル（error、warn、info、debug）で出力
- デバッグ時のベストプラクティス：
  - 問題の再現手順を明確にする
  - エラーログとスタックトレースを確認
  - 必要に応じてデバッグログを追加（本番環境へのコミット前に削除）

### パフォーマンスとセキュリティ

- **パフォーマンスの考慮事項**：
  - 不必要なループや再計算を避ける
  - 大量のデータを扱う場合は、ページネーションやストリーミングを検討
  - 非同期処理を適切に活用
- **セキュリティのベストプラクティス**：
  - ユーザー入力は必ず検証とサニタイズを実施
  - SQLインジェクション、XSS、CSRF対策を徹底
  - 機密情報（API キー、パスワード等）は環境変数で管理
  - 依存関係は定期的に更新し、セキュリティ脆弱性をチェック

## プロジェクト目標

### 開発スタイル

- **各タスクの要件と設計は`.tmp/design.md`に文書化する**
- **各メインタスクの詳細なサブタスクは`.tmp/task.md`に定義する**
- **作業の進捗に応じて`.tmp/task.md`を更新する**

### ワークフロー

1. まず計画を作成し、要件を`.tmp/design.md`に文書化
2. 要件に基づき、必要なタスクをすべて特定し`.tmp/task.md`にリスト化
3. 計画が確定したら、新しいブランチを作成して作業開始
   - ブランチ名：`feature/`で始まり、タスクの簡潔な要約を続ける
4. タスクは1つのコミットで完了できる小さな管理可能な単位に分割
5. 各タスクの進捗管理用チェックリストを作成
6. コードの可読性を維持するため、常にコードフォーマッタを適用
7. コミットは行わず、確認を求める
8. Pull Request（PR）作成指示があった場合、以下のフォーマットを使用：
   - **タイトル**：タスクの簡潔な要約
   - **主な変更点**：変更内容、注意点等を説明
   - **テスト**：合格したテスト、追加したテスト、テストの実行方法を明記
   - **関連タスク**：関連タスクのリンクまたは番号を提供
   - **その他**：特記事項や関連情報を記載

## コードレビューチェックリスト

PRやコードレビュー時に確認すべき項目：

- [ ] コードスタイルガイドラインに従っているか
- [ ] 適切なエラーハンドリングが実装されているか
- [ ] テストが追加/更新されているか
- [ ] ドキュメントが更新されているか
- [ ] パフォーマンスへの影響を考慮したか
- [ ] セキュリティリスクがないか確認したか
- [ ] 依存関係の追加は妥当か
- [ ] 後方互換性が保たれているか

## 開発環境のベストプラクティス

- **バージョン管理**：
  - コミットメッセージは明確で説明的に
  - 頻繁に小さなコミットを作成
  - 機能ブランチで作業し、mainブランチは常に安定状態を保つ
- **依存関係管理**：
  - package-lock.jsonやyarn.lockは必ずコミット
  - 依存関係の更新は慎重に行い、変更ログを確認
- **開発ツール**：
  - ESLint、Prettier等のツールを活用してコード品質を維持
  - pre-commitフックを使用して自動チェックを実施
  - CI/CDパイプラインで自動テストとビルドを実行

## トラブルシューティングガイド

問題が発生した場合の対処手順：

1. **エラーメッセージを詳細に読む**
2. **関連するログファイルを確認**
3. **最近の変更を確認**（git diff、git log）
4. **テスト環境で問題を再現**
5. **段階的にデバッグ**（console.log、デバッガーを活用）
6. **必要に応じて前のコミットに戻って確認**

## 継続的改善

- 定期的にコードベースをリファクタリング
- パフォーマンスメトリクスを監視
- ユーザーフィードバックを積極的に取り入れる
- チーム内でのナレッジ共有を促進
- ベストプラクティスと学んだ教訓を文書化

---

